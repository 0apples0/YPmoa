<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper	namespace="com.moa.youthpolicy.suggest.mapper.SuggestMapper">
	<select id="select" resultType="SuggestVO">
		SELECT * FROM suggestedboard
		ORDER BY bno DESC
	</select>
	
	<insert id="write" parameterType="SuggestVO">
		INSERT INTO  suggestedboard
		(title,content,writer,category,region)
		VALUES (#{title}, #{content}, #{writer}, #{category}, #{region})
	</insert>
	
    <update id="modifyBoard" parameterType="com.moa.youthpolicy.suggest.domain.SuggestVO">
        UPDATE suggestedboard
        SET title = #{title}, content = #{content}, category = #{category}, region = #{region}
        WHERE bno = #{bno}
    </update>
	
	<select id="delete" parameterType="SuggestVO">
		DELETE FROM suggestedboard
		WHERE bno=#{bno}
	</select>
	
	<select id="getTotalCount" resultType="int" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT COUNT(bno) FROM suggestedboard
		WHERE bno>0
		<if test="writer != null and writer != ''">
			And writer = #{writer}
		</if>
	    <if test="type != null and keyword != null and keyword != ''">
	    	<choose>
	    		<when test='type == "TC"'>
	                AND (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
	            </when>
	            <when test='type == "T"'>
	                AND title LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	            <when test='type == "W"'>
	                AND writer LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	        </choose>
		</if>
	    <if test="rgnSeNm != null and rgnSeNm != ''">
	        AND region LIKE CONCAT('%', #{rgnSeNm}, '%')
	    </if>
	    <if test="policyTypeNm != null and policyTypeNm != ''">
	        AND category LIKE CONCAT('%', #{policyTypeNm}, '%')
	    </if>
	</select>
	
	<select id="getListWithPaging" resultType="SuggestVO" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT * FROM suggestedboard
		WHERE bno>0
		<if test="writer != null and writer != ''">
			And writer = #{writer}
		</if>
	    <if test="type != null and keyword != null and keyword != ''">
	        <choose>
	            <when test='type == "TC"'>
	                AND (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
	            </when>
	            <when test='type == "T"'>
	                AND title LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	            <when test='type == "W"'>
	                AND writer LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	        </choose>
	    </if>
	    <if test="rgnSeNm != null and rgnSeNm != ''">
	        AND region LIKE CONCAT('%', #{rgnSeNm}, '%')
	    </if>
	    <if test="policyTypeNm != null and policyTypeNm != ''">
	        AND category LIKE CONCAT('%', #{policyTypeNm}, '%')
	    </if>
	    
		ORDER BY
	    <choose>
	        <when test="selectedFilter == 'like'">
	            `like` DESC, bno DESC
	        </when>
	        <otherwise>
	            bno DESC
	        </otherwise>
	    </choose>		
		LIMIT #{start}, #{amount}
	</select>
	
	<select id="getBoard" resultType="SuggestVO" parameterType="SuggestVO">
		SELECT * FROM suggestedboard WHERE bno=#{bno}
	</select>
	
</mapper>