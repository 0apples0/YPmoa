<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper	namespace="com.moa.youthpolicy.policy.mapper.PolicyMapper">
	<select id="getfiveboard" resultType="com.moa.youthpolicy.policy.domain.PolicyVO">
		SELECT * FROM policy ORDER BY no DESC LIMIT 5
	</select>
	
	<select id="getListWithPasing" resultType="com.moa.youthpolicy.policy.domain.PolicyVO" parameterType="com.moa.youthpolicy.common.Criteria">
	    SELECT * FROM policy
	    WHERE no > 0
	    <if test="type != null and keyword != null and keyword != ''">
	        <choose>
	            <when test='type == "TC"'>
	                AND (policyNm LIKE CONCAT('%', #{keyword}, '%') OR policyCn LIKE CONCAT('%', #{keyword}, '%'))
	            </when>
	            <when test='type == "T"'>
	                AND policyNm LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	            <when test='type == "C"'>
	                AND policyCn LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	        </choose>
	    </if>
	    <if test="rgnSeNm != null and rgnSeNm != ''">
	        AND rgnSeNm LIKE CONCAT('%', #{rgnSeNm}, '%')
	    </if>
	    <if test="policyTypeNm != null and policyTypeNm != ''">
	        AND policyTypeNm LIKE CONCAT('%', #{policyTypeNm}, '%')
	    </if>
	    <if test="selectedFilter == 'applyDate'">
	        AND aplyPsbltyYn = 'Y'
	    </if>
	    <if test="selectedFilter == 'overDate'">
	        AND aplyPsbltyYn = 'N'
	    </if>
	    ORDER BY
	    <choose>
	        <when test="selectedFilter == 'like'">
	            `like` DESC, policy.no DESC
	        </when>
	        <otherwise>
	            policy.no DESC
	        </otherwise>
	    </choose>
	    LIMIT #{start}, #{amount}
	</select>
	
	<select id="getTotalCount" resultType="int" parameterType="com.moa.youthpolicy.common.Criteria">
	    SELECT COUNT(no) FROM policy
	    WHERE no > 0
	    <if test="type != null and keyword != null and keyword != ''">
		    <choose>
	            <when test='type == "TC"'>
	                AND (policyNm LIKE CONCAT('%', #{keyword}, '%') OR policyCn LIKE CONCAT('%', #{keyword}, '%'))
	            </when>
	            <when test='type == "T"'>
	                AND policyNm LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	            <when test='type == "C"'>
	                AND policyCn LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	        </choose>
		</if>
	    <if test="rgnSeNm != null and rgnSeNm != ''">
	        AND rgnSeNm LIKE CONCAT('%', #{rgnSeNm}, '%')
	    </if>
	    <if test="policyTypeNm != null and policyTypeNm != ''">
	        AND policyTypeNm LIKE CONCAT('%', #{policyTypeNm}, '%')
	    </if>
	    <if test="selectedFilter == 'applyDate'">
	        AND aplyPsbltyYn = 'Y'
	    </if>
	    <if test="selectedFilter == 'overDate'">
	        AND aplyPsbltyYn = 'N'
	    </if>
	</select>
	
	<select id="getPolicy" resultType="com.moa.youthpolicy.policy.domain.PolicyVO" parameterType="Integer">
		SELECT * FROM policy
		WHERE no = #{no}
	</select>
	
	<select id="getBoard" resultType="com.moa.youthpolicy.policy.domain.PolicyBoardVO" parameterType="Integer">
		SELECT * FROM policyboard
		WHERE bno = #{no}
	</select>
	
	<select id="getLike" resultType="com.moa.youthpolicy.common.LikeBoardVO" parameterType="com.moa.youthpolicy.common.LikeBoardVO">
		SELECT * FROM like_policy
	    WHERE Email LIKE #{Email} AND bno LIKE #{bno}
	</select>
	
	<select id="getCommentListWithPaging" resultType="PolicyCommentVO" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT * FROM policyboardcomments
		WHERE cno>0 AND bno=#{bno}
		ORDER BY cno DESC
		LIMIT #{start}, #{amount}
	</select>
	
	<select id="getCommentTotalCount" resultType="int" parameterType="PolicyBoardVO">
		SELECT COUNT(cno) FROM policyboardcomments
		WHERE bno=#{no}
	</select>
	
	<select id="getBestCommentList" resultType="PolicyCommentVO" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT * FROM policyboardcomments
		WHERE cno>0 AND bno=#{bno} AND `like`>=10
		ORDER BY cno DESC
		LIMIT #{amountBestComment}
	</select>
	
	<delete id="delLike" parameterType="com.moa.youthpolicy.common.LikeBoardVO">
		DELETE FROM like_policy
    	WHERE Email = #{Email} AND bno = #{bno}
	</delete>
	
	<insert id="addLike" parameterType="com.moa.youthpolicy.common.LikeBoardVO">
	    INSERT INTO like_policy (Email, bno, boardType)
	    VALUES (#{Email}, #{bno}, 'P')
	</insert>
	
	<update id="modLike" parameterType="com.moa.youthpolicy.policy.domain.PolicyBoardVO">
	    UPDATE policy SET `like` = #{like}
	    WHERE no = #{no}
	</update>
	
	<update id="modBoard" parameterType="com.moa.youthpolicy.policy.domain.PolicyVO">
        UPDATE policy
        SET aplyBgngDt = #{aplyBgngDt}, rgnSeNm = #{rgnSeNm},
        policyCn = #{policyCn}, sprvsnInstNm = #{sprvsnInstNm}, policyTypeNm = #{policyTypeNm}, policyScl = #{policyScl},
        aplyEndDt = #{aplyEndDt}, dtlLinkUrl = #{dtlLinkUrl}
        WHERE no = #{no}   
	</update>
	
	<update id="modp_Board" parameterType="com.moa.youthpolicy.policy.domain.PolicyBoardVO">
	    UPDATE policyboard
	    SET content = #{content}
	    WHERE bno = #{bno}   
	</update>

	
	
	
	
	
</mapper>