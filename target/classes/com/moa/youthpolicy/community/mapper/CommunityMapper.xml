<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper	namespace="com.moa.youthpolicy.community.mapper.CommunityMapper">
	<select id="getfiveboard" resultType="CommunityVO">
		SELECT * FROM tipboard
		ORDER BY bno
		DESC LIMIT 5
	</select>

	<select id="select" resultType="CommunityVO">
		select * from tipboard
		ORDER BY bno DESC
	</select>
	
	<select id="delete" parameterType="CommunityVO">
		DELETE FROM tipboard
		WHERE bno=#{bno}
	</select>
	
	<select id="getTotalCount" resultType="int" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT COUNT(bno) FROM tipboard
		WHERE bno>0
		<if test="writer != null and writer != ''">
			And writer = #{writer}

		</if>
	    <if test="type != null and keyword != null and keyword != ''">
		    
	        <choose>
	            <when test='type == "TC"'>
	                AND (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
	            </when>
	            <when test='type == "T"'>
	                AND title LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	            <when test='type == "W"'>
	                AND writer LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	        </choose>
		</if>
	    <if test="rgnSeNm != null and rgnSeNm != ''">
	        AND region LIKE CONCAT('%', #{rgnSeNm}, '%')
	    </if>
	    <if test="policyTypeNm != null and policyTypeNm != ''">
	        AND category LIKE CONCAT('%', #{policyTypeNm}, '%')
	    </if>
	
		
		<!--
		<if test="type != null and type !='' and keyword !=null and keyword!=''">
			AND ${type} LIKE CONCAT('%', #{keyword}, '%') 
		</if>
		-->
		
	</select>
	
	<select id="getListWithPaging" resultType="CommunityVO" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT * FROM tipboard
		WHERE bno>0
		<if test="writer != null and writer != ''">
			And writer = #{writer}

		</if>
	    <if test="type != null and keyword != null and keyword != ''">
	        <choose>
	            <when test='type == "TC"'>
	                AND (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
	            </when>
	            <when test='type == "T"'>
	                AND title LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	            <when test='type == "W"'>
	                AND writer LIKE CONCAT('%', #{keyword}, '%')
	            </when>
	        </choose>
	    </if>
	    <if test="rgnSeNm != null and rgnSeNm != ''">
	        AND region LIKE CONCAT('%', #{rgnSeNm}, '%')
	    </if>
	    <if test="policyTypeNm != null and policyTypeNm != ''">
	        AND category LIKE CONCAT('%', #{policyTypeNm}, '%')
	    </if>
		
		ORDER BY
	    <choose>
	        <when test="selectedFilter == 'like'">
	            `like` DESC, bno DESC
	        </when>
	        <otherwise>
	            bno DESC
	        </otherwise>
	    </choose>		
		LIMIT #{start}, #{amount}
	</select>
	
	<select id="getBoard" resultType="CommunityVO" parameterType="CommunityVO">
		SELECT * FROM tipboard WHERE bno=#{bno}
	</select>
	
	<select id="getCommentTotalCount" resultType="int" parameterType="CommunityVO">
		SELECT COUNT(cno) FROM tipboardcomments
		WHERE bno=#{bno}
	</select>
	
	<select id="getCommentListWithPaging" resultType="CommunityCommentVO" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT * FROM tipboardcomments
		WHERE cno>0 AND bno=#{bno}
		ORDER BY cno DESC
		LIMIT #{start}, #{amount}
	</select>
	
	<select id="getBestCommentList" resultType="CommunityCommentVO" parameterType="com.moa.youthpolicy.common.Criteria">
		SELECT * FROM tipboardcomments
		WHERE cno>0 AND bno=#{bno} AND `like`>=10
		ORDER BY cno DESC
		LIMIT #{amountBestComment}
	</select>

	<insert id="writeComment" parameterType="CommunityCommentVO">
		INSERT INTO tipboardcomments
		(content, bno, writer)
		values(#{content}, #{bno}, #{writer})
	</insert>	

	<delete id="deleteComment" parameterType="Integer">
		DELETE FROM tipboardcomments
		WHERE cno=#{cno}
	</delete>	
</mapper>